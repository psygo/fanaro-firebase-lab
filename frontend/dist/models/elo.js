"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const game_record_1 = require("./game_record");
class Elo {
    num;
    static kBelow1500 = 50;
    static kBelow2000 = 40;
    static kAboveOrEqual2000 = 30;
    constructor(num) {
        this.num = num;
    }
    serialize = () => this.num;
    static deserialize = (json) => new Elo(json);
    get danOrKyu() {
        return this.num >= 2000;
    }
    danFormatter = (long = false) => (Math.floor(this.num / 100) - 20 + 1).toString() + (long ? " dan" : "d");
    kyuFormatter = (long = false) => Math.floor(20 - this.num / 100).toString() + (long ? " kyu" : "k");
    danKyuLevel = (long = false) => this.danOrKyu ? this.danFormatter(long) : this.kyuFormatter(long);
    get k() {
        return this.num < 1500
            ? Elo.kBelow1500
            : this.num < 2000
                ? Elo.kBelow2000
                : Elo.kAboveOrEqual2000;
    }
    deltaFromGame = (opponentElo, gameResult) => {
        if (gameResult === game_record_1.GameResultStatus.Voided)
            return this;
        const levelDiff = opponentElo.num - this.num;
        const gameResultAsNumber = gameResult === game_record_1.GameResultStatus.Win ? 1 : 0;
        const expectedValue = 1 / (1 + 10 ** (levelDiff / 400));
        return new Elo(Math.round((gameResultAsNumber - expectedValue) * this.k));
    };
    add = (delta) => new Elo(this.num + delta.num);
}
exports.default = Elo;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWxvLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL21vZGVscy9lbG8udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSwrQ0FBaUQ7QUFLakQsTUFBcUIsR0FBRztJQUtNO0lBSnBCLE1BQU0sQ0FBVSxVQUFVLEdBQVcsRUFBRSxDQUFDO0lBQ3hDLE1BQU0sQ0FBVSxVQUFVLEdBQVcsRUFBRSxDQUFDO0lBQ3hDLE1BQU0sQ0FBVSxpQkFBaUIsR0FBVyxFQUFFLENBQUM7SUFFdkQsWUFBNEIsR0FBVztRQUFYLFFBQUcsR0FBSCxHQUFHLENBQVE7SUFBRyxDQUFDO0lBRTNDLFNBQVMsR0FBRyxHQUFrQixFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQztJQUUxQyxNQUFNLENBQUMsV0FBVyxHQUFHLENBQUMsSUFBZSxFQUFPLEVBQUUsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxJQUFjLENBQUMsQ0FBQztJQUV2RSxJQUFZLFFBQVE7UUFDbEIsT0FBTyxJQUFJLENBQUMsR0FBRyxJQUFJLElBQUksQ0FBQztJQUMxQixDQUFDO0lBRU8sWUFBWSxHQUFHLENBQUMsT0FBZ0IsS0FBSyxFQUFVLEVBQUUsQ0FDdkQsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRW5FLFlBQVksR0FBRyxDQUFDLE9BQWdCLEtBQUssRUFBVSxFQUFFLENBQ3ZELElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFckUsV0FBVyxHQUFHLENBQUMsT0FBZ0IsS0FBSyxFQUFVLEVBQUUsQ0FDOUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUVwRSxJQUFZLENBQUM7UUFDWCxPQUFPLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSTtZQUNwQixDQUFDLENBQUMsR0FBRyxDQUFDLFVBQVU7WUFDaEIsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSTtnQkFDakIsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFVO2dCQUNoQixDQUFDLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDO0lBQzVCLENBQUM7SUFFRCxhQUFhLEdBQUcsQ0FBQyxXQUFnQixFQUFFLFVBQTRCLEVBQU8sRUFBRTtRQUN0RSxJQUFJLFVBQVUsS0FBSyw4QkFBZ0IsQ0FBQyxNQUFNO1lBQUUsT0FBTyxJQUFJLENBQUM7UUFFeEQsTUFBTSxTQUFTLEdBQUcsV0FBVyxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDO1FBRTdDLE1BQU0sa0JBQWtCLEdBQ3RCLFVBQVUsS0FBSyw4QkFBZ0IsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRTlDLE1BQU0sYUFBYSxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxTQUFTLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUV4RCxPQUFPLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxrQkFBa0IsR0FBRyxhQUFhLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM1RSxDQUFDLENBQUM7SUFFRixHQUFHLEdBQUcsQ0FBQyxLQUFVLEVBQU8sRUFBRSxDQUFDLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDOztBQTdDM0Qsc0JBOENDIn0=